<?xml version="1.0" encoding="utf-8"?>

<!--
 !
 !  Cell Diagramming Language
 !
 !  Copyright (c) 2018  David Brooks
 !
 !  Licensed under the Apache License, Version 2.0 (the "License");
 !  you may not use this file except in compliance with the License.
 !  You may obtain a copy of the License at
 !
 !      http://www.apache.org/licenses/LICENSE-2.0
 !
 !  Unless required by applicable law or agreed to in writing, software
 !  distributed under the License is distributed on an "AS IS" BASIS,
 !  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 !  See the License for the specific language governing permissions and
 !  limitations under the License.
 !
 !-->

<cell-diagram xmlns="http://www.cellml.org/celldl/1.0#">

    <!-- Representation of diagram at http://sites.bioeng.auckland.ac.nz/mwu035/mpb/  -->

    <diagram>
        <quantity id="q1"  class="sodium"    label="$\text{q}_1^{[\text{Na}^+]_\text{o}}$"/>
        <quantity id="q4"  class="potassium" label="$\text{q}_4^{[\text{K}^+]_\text{o}}$"/>
        <quantity id="q7"  class="anion"     label="$\text{q}_7^{[\text{OH}^-]_\text{o}}$"/>
        <quantity id="q9"  class="anion"     label="$\text{q}_9^{[\text{HCO}_3^-]_\text{o}}$"/>
        <quantity id="q11" class="chloride"  label="$\text{q}_11^{[\text{Cl}^-]_\text{o}}$"/>
        <quantity id="q13" class="hydrogen"  label="$\text{q}_13^{[\text{H}^+]_\text{o}}$"/>
        <quantity id="q16" class="calcium"   label="$\text{q}_16^{[\text{Ca}^{2+}]_\text{o}}$"/>

        <compartment id="cell" class="cell">
            <transporters>
                <transporter id="Na"   class="sodium channel" label="$\text{I}_\text{Na}"/>
                <transporter id="Na-b" class="sodium channel" label="$\text{I}_\text{Na,b}"/>
                <transporter id="pNa"  class="sodium channel" label="$\text{I}_\text{pNa}"/>

                <transporter id="NKE"  class="metabolic sodium potassium exchanger"/>

                <transporter id="K1"   class="potassium channel" label="$\text{I}_\text{K1}"/>
                <transporter id="Kr"   class="potassium channel" label="$\text{I}_\text{Kr}"/>
                <transporter id="Ks"   class="potassium channel" label="$\text{I}_\text{Ks}"/>
                <transporter id="Katp" class="potassium channel" label="$\text{I}_{\text{K}_\text{ATP}}"/>

                <transporter id="NBC"  class="sodium bicarbonate exchanger"/>
                <transporter id="CHE"  class="chloride hydrogen exchanger"/>
                <transporter id="AE"   class="anion exchanger"/>
                <transporter id="Cl"   class="chloride channel" label="$\text{I}_\text{Cl}"/>
                <transporter id="NHE"  class="sodium hydrogen exchanger"/>

                <transporter id="NCE"  class="sodium calcium exchanger"/>
                <transporter id="pCa"  class="metabolic calcium exchanger"/>
                <transporter id="Ca-b" class="calcium channel" label="$\text{I}_\text{Ca,b}"/>
                <transporter id="Ca-t" class="calcium channel" label="$\text{I}_\text{Ca,t}"/>
                <transporter id="CaL"  class="calcium channel" label="$\text{I}_\text{CaL}"/>
            </transporters>

            <quantity id="q2"  class="sodium"    label="$\text{q}_2^{[\text{Na}^+]_\text{i}}$"/>
            <quantity id="q5"  class="potassium" label="$\text{q}_5^{[\text{K}^+]_\text{i}}$"/>

            <quantity id="q8"  class="anion"     label="$\text{q}_8^{[\text{OH}^-]_\text{i}}$"/>
            <quantity id="q10" class="anion"     label="$\text{q}_10^{[\text{HCO}_3^-]_\text{i}}$"/>
            <quantity id="q12" class="chloride"  label="$\text{q}_12^{[\text{Cl}^-]_\text{i}}$"/>

            <quantity id="q14" class="hydrogen"  label="$\text{q}_14^{[\text{H}^+]_\text{i}}$"/>

            <quantity id="q17" class="calcium"   label="$\text{q}_17^{[\text{Ca}^{2+}]_\text{i}}$"/>
            <quantity id="q18" class="calcium"   label="$\text{q}_18^{[\text{Ca}^{2+}]_\text{i}}$"/>
            <quantity id="q19" class="calcium"   label="$\text{q}_19^{[\text{Ca}^{2+}\text{-CMDN}]_\text{i}}$"/>
            <quantity id="q20" class="calcium"   label="$\text{q}_20^{[\text{Ca}^{2+}\text{-TRPN}]_\text{i}}$"/>

            <compartment id="atp" class="metabolic">
                <quantity id="q24" class="metabolic" label="$\text{q}_24^{[\text{ATP}]_\text{i}}$"/>
                <quantity id="q25" class="metabolic" label="$\text{q}_25^{[\text{ADP}]}$"/>
                <quantity id="q26" class="metabolic" label="$\text{q}_26^{[\text{P}]_\text{i}}$"/>
            </compartment>

            <compartment id="SR" class="organelle reticulum">
                <transporters>
                    <transporter id="SERCA" class="metabolic calcium exchanger"/>
                    <transporter id="RyR"   class="calcium channel" />
                </transporters>
                <quantity id="q21" class="calcium" label="$\text{q}_21^{[\text{Ca}^{2+}]_\text{i}}$"/>
                <quantity id="q22" class="calcium" label="$\text{q}_22^{[\text{Ca}^{2+}\text{-CSNQ}]_\text{i}}$"/>
            </compartment>

            <compartment id="mitochrondion" class="organelle mitochondrion">
                <transporters>
                    <transporter id="m-NCE"  label="NCE"  class="sodium calcium exchanger"/>
                    <transporter id="m-NHE"  label="NHE"  class="sodium hydrogen exchanger"/>
                    <transporter id="m-KHE"  label="KHE"  class="potassium hydrogen exchanger"/>
                    <transporter id="m-CI"   label="CI"   class="hydrogen exchanger"/>
                    <transporter id="m-CIII" label="CIII" class="hydrogen exchanger"/>
                    <transporter id="m-CIV"  label="CIV"  class="hydrogen exchanger"/>
                    <transporter id="m-CII"  label="CII"  class="hydrogen exchanger"/>
                </transporters>
                <quantity id="q23" class="calcium"   label="$\text{q}_23^{[\text{Ca}^{2+}]_\text{i}}$"/>
                <quantity id="q3"  class="sodium"    label="$\text{q}_3^{[\text{Na}^+]_\text{i}}$"/>
                <quantity id="q6"  class="potassium" label="$\text{q}_6^{[\text{K}^+]_\text{i}}$"/>
                <quantity id="q15" class="hydrogen"  label="$\text{q}_15^{[\text{H}^+]_\text{i}}$"/>
            </compartment>
        </compartment>
    </diagram>

    <bond-graph>
        <potential id="u1"  quantity="q1"/>
        <potential id="u2"  quantity="q2"/>
        <potential id="u3"  quantity="q3"/>
        <potential id="u4"  quantity="q4"/>
        <potential id="u5"  quantity="q5"/>
        <potential id="u6"  quantity="q6"/>
        <potential id="u7"  quantity="q7"/>
        <potential id="u8"  quantity="q8"/>
        <potential id="u9"  quantity="q9"/>
        <potential id="u10" quantity="q10"/>
        <potential id="u11" quantity="q11"/>
        <potential id="u12" quantity="q12"/>
        <potential id="u13" quantity="q13"/>
        <potential id="u14" quantity="q14"/>
        <potential id="u15" quantity="q15"/>
        <potential id="u16" quantity="q16"/>
        <potential id="u17" quantity="q17"/>
        <potential id="u18" quantity="q18"/>
        <potential id="u19" quantity="q19"/>
        <potential id="u20" quantity="q20"/>
        <potential id="u21" quantity="q21"/>
        <potential id="u22" quantity="q22"/>
        <potential id="u23" quantity="q23"/>
        <potential id="u24" quantity="q24"/>
        <potential id="u25" quantity="q25"/>
        <potential id="u26" quantity="q26"/>

        <flow id="v1" transporter="Na">
            <flux from="u1" to="u2"/>
        </flow>
        <flow id="v2" transporter="Na-b">
            <flux from="u1" to="u2"/>
        </flow>
        <flow id="v3" transporter="pNa">
            <flux from="u1" to="u2"/>
        </flow>
        <flow id="v4" transporter="NKE">
            <flux from="u2" to="u1" count="3"/>
            <flux from="u4" to="u5" count="2"/>
        </flow>

        <flow id="v6" transporter="NBC">
            <flux from="u7" to="u2"/>
            <flux from="u9" to="u10"/>
        </flow>
        <flow id="v7" transporter="NHE">
            <flux from="u14" to="u13"/>
            <flux from="u1" to="u2"/>
        </flow>

        <flow id="v5" transporter="NCE">
            <flux from="u1" to="u2" count="3"/>
            <flux from="u17" to="u16"/>
        </flow>

        <flow id="v8" transporter="m-NCE">
            <flux from="u2" to="u3" count="3"/>
            <flux from="u23" to="u17"/>
        </flow>
        <flow id="v9" transporter="m-NHE">
            <flux from="u3" to="u2"/>
            <flux from="u14" to="u15"/>
        </flow>

        <flow id="v10" transporter="K1">
            <flux from="u4" to="u5"/>
        </flow>
        <flow id="v11" transporter="Kr">
            <flux from="u4" to="u5"/>
        </flow>
        <flow id="v12" transporter="Ks">
            <flux from="u4" to="u5"/>
        </flow>
        <flow id="v13" transporter="Katp">
            <flux from="u4" to="u5"/>
        </flow>
        <flow id="v14" transporter="m-KHE">
            <flux from="u6" to="u5"/>
            <flux from="u14" to="u15"/>
        </flow>

        <flow id="v16" transporter="Cl">
            <flux from="u12" to="u11"/>
        </flow>
        <flow id="v17" transporter="CHE">
            <flux from="u11" to="u12"/>
            <flux from="u8" to="u7"/>
        </flow>
        <flow id="v18" transporter="AE">
            <flux from="u11" to="u12"/>
            <flux from="u10" to="u9"/>
        </flow>

        <flow id="v15">
            <flux from="u5" to="u6"/>
        </flow>

        <flow id="v19" transporter="pCa">
            <flux from="u17" to="u16"/>
        </flow>
        <flow id="v20" transporter="Ca-b">
            <flux from="u16" to="u17"/>
        </flow>
        <flow id="v21" transporter="Ca-t">
            <flux from="u16" to="u17"/>
        </flow>
        <flow id="v22" transporter="CaL">
            <flux from="u16" to="u18"/>
        </flow>
        <flow id="v23" transporter="RyR">
            <flux from="u21" to="u18"/>
        </flow>
        <flow id="v24">
            <flux from="u18" to="u17"/>
        </flow>
        <flow id="v25" class="dashed">  <!-- what does a dashed path signify?? -->
            <flux from="u17" to="u19"/>
        </flow>
        <flow id="v26" class="dashed">
            <flux from="u17" to="u20"/>
        </flow>
        <flow id="v27" transporter="SERCA">
            <flux from="u17" to="u21" count="2"/>
        </flow>
        <flow id="v28">
            <flux from="u21" to="u22"/>
        </flow>
        <flow id="v29">
            <flux from="u23" to="u17"/>
        </flow>

        <!-- flow v30 ?? -->

        <flow id="v31" transporter="m-CI">
            <flux from="u14" to="u15"/>
        </flow>
        <flow id="v32" transporter="m-CIII">
            <flux from="u14" to="u15"/>
        </flow>
        <flow id="v33" transporter="m-CIV">
            <flux from="u14" to="u15"/>
        </flow>
        <flow id="v34" transporter="m-CII">
            <flux from="u14" to="u15"/>
        </flow>
        <flow id="v35">
            <flux from="u24" to="u25 u26"/>
        </flow>
    </bond-graph>


<!--

    All coordinates are wrt the object containing the element.

    Origin is at top left corner of containing object's bounding box.

    Bounding box has size (bounds-X bounds-Y).

stylesheet might specify scale, position, size??
-->

    <geometry size="1040px 685px">
        <box ref="cell" pos="11% 25%" size="88% 74%">
            <!-- Cell membrane transporters -->
            <boundary>
                <top>
                    <item ref="Na"   pos="9%"/>
                    <item ref="Na-b" pos="13%"/>
                    <item ref="pNa"  pos="17%"/>
                    <item ref="NKE"  pos="24%"/>
                    <item ref="K1"   pos="29%"/>
                    <item ref="Kr"   pos="33%"/>
                    <item ref="Ks"   pos="37%"/>
                    <item ref="Katp" pos="41%"/>
                    <item ref="NBC"  pos="46%"/>
                    <item ref="CHE"  pos="51%"/>
                    <item ref="AE"   pos="56%"/>
                    <item ref="Cl"   pos="61%"/>
                    <item ref="NHE"  pos="69%"/>
                </top>
                <left>
                    <item ref="NCE"  pos="14%"/>
                    <item ref="pCa"  pos="31%"/>
                    <item ref="Ca-b" pos="37%"/>
                    <item ref="Ca-t" pos="43%"/>
                    <item ref="CaL"  pos="75%"/>
                </left>
            </boundary>

            <item ref="q1"  pos="13% -25%"/>
            <item ref="q4"  pos="35% -25%"/>
            <item ref="q7"  pos="49% -25%"/>
            <item ref="q9"  pos="58% -25%"/>
            <item ref="q11" pos="61% -25%"/>
            <item ref="q13" pos="77% -16%"/>
            <item ref="q16" pos="-9%  28%"/>
            <item ref="q2"  pos="13%  20%"/>
            <item ref="q5"  pos="35%  20%"/>
            <item ref="q8"  pos="49%  20%"/>
            <item ref="q10" pos="58%  20%"/>
            <item ref="q12" pos="61%  20%"/>
            <item ref="q14" pos="77%  29%"/>
            <item ref="q17" pos="10%  28%"/>
            <item ref="q18" pos=" 8%  90%"/>
            <item ref="q19" pos="35%  42%"/>
            <item ref="q20" pos="35%  50%"/>

            <box ref="mitochrondion" pos="46% 50%" size="37% 27%">
                <!-- Mitochrondion transporters -->
                <boundary>
                    <top>
                        <item ref="m-NCE"  pos="15%"/>
                        <item ref="m-NHE"  pos="25%"/>
                        <item ref="m-KHE"  pos="35%"/>
                        <item ref="m-CI"   pos="45%"/>
                        <item ref="m-CII"  pos="55%"/>
                        <item ref="m-CIII" pos="65%"/>
                        <item ref="m-CIV"  pos="75%"/>
                    </top>
                </boundary>
                <item ref="q3"  pos="12% 48%"/>
                <item ref="q6"  pos="24% 48%"/>
                <item ref="q15" pos="36% 48%"/>
                <item ref="q23" pos="75% 27%"/>
            </box>

            <box ref="SR" pos="13% 70%" size="25% 25%">
                <!-- Sarcoplasmic reticulum transporters -->
                <boundary>
                    <top>
                        <item ref="SERCA" pos="20%"/>
                    </top>
                    <left>
                        <item ref="RyR"  pos="15%"/>
                    </left>
                </boundary>
                <item ref="q21"  pos="20% 75%"/>
                <item ref="q22"  pos="70% 75%"/>
            </box>

            <box ref="atp" pos="85% 5%" size="12% 30%">
                <item ref="q24"  pos="15% 15%"/>
                <item ref="q25"  pos="85% 10%"/>
                <item ref="q26"  pos="85% 90%"/>
            </box>

        </box>
    </geometry>

    <style>
        /* Potentials wrt quantities */
        #u1 { pos: below ; }
        #u2 { pos: above ; }
        #u3 { pos: above ; }
        #u4 { pos: below ; }
        #u5 { pos: above ; }
        #u6 { pos: above ; }
        #u7 { pos: below ; }
        #u8 { pos: above ; }
        #u9 { pos: below ; }
        #u10 { pos: above ; }
        #u11 { pos: below ; }
        #u12 { pos: above ; }
        #u13 { pos: left ; }
        #u14 { pos: left ; }
        #u15 { pos: left ; }
        #u16 { pos: below ; }
        #u17 { pos: below ; }
        #u18 { pos: above ; }
        #u19 { pos: left ; }
        #u20 { pos: left ; }
        #u21 { pos: above ; }
        #u22 { pos: above ; }
        #u23 { pos: above ; }
        #u24 { pos: below ; }
        #u25 { pos: below ; }
        #u26 { pos: above ; }

        /* Flows wrt transporters */
        #v1 { pos: above ; }
        #v2 { pos: above ; }
        #v3 { pos: above ; }
        #v4 { pos: above ; }
        #v5 { pos: left ; }
        #v6 { pos: above ; }
        #v7 { pos: above ; }
        #v8 { pos: above ; }
        #v9 { pos: above ; }
        #v10 { pos: above ; }
        #v11 { pos: above ; }
        #v12 { pos: above ; }
        #v13 { pos: above ; }
        #v14 { pos: above ; }
        #v15 { pos: above ; }
        #v16 { pos: above ; }
        #v17 { pos: above ; }
        #v18 { pos: above ; }
        #v19 { pos: left ; }
        #v20 { pos: left ; }
        #v21 { pos: left ; }
        #v22 { pos: left ; }
        #v23 { pos: right ; }
        #v27 { pos: above ; }
        #v29 { pos: above ; }
        #v31 { pos: above ; }
        #v32 { pos: above ; }
        #v33 { pos: above ; }
        #v34 { pos: above ; }
    </style>

</cell-diagram>
